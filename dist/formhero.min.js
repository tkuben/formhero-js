!function(e){function t(e){return"[object Array]"===Object.prototype.toString.call(e)}function o(){for(var e=0;e<A.length;e++)A[e][0](A[e][1]);A=[],v=!1}function n(e,t){A.push([e,t]),v||(v=!0,x(o,0))}function r(e,t){function o(e){s(t,e)}function n(e){l(t,e)}try{e(o,n)}catch(r){n(r)}}function a(e){var t=e.owner,o=t.state_,n=t.data_,r=e[o],a=e.then;if("function"==typeof r){o=w;try{n=r(n)}catch(c){l(a,c)}}i(a,n)||(o===w&&s(a,n),o===g&&l(a,n))}function i(e,t){var o;try{if(e===t)throw new TypeError("A promises callback cannot return that same promise.");if(t&&("function"==typeof t||"object"==typeof t)){var n=t.then;if("function"==typeof n)return n.call(t,function(n){o||(o=!0,t!==n?s(e,n):c(e,n))},function(t){o||(o=!0,l(e,t))}),!0}}catch(r){return o||l(e,r),!0}return!1}function s(e,t){e!==t&&i(e,t)||c(e,t)}function c(e,t){e.state_===y&&(e.state_=b,e.data_=t,n(f,e))}function l(e,t){e.state_===y&&(e.state_=b,e.data_=t,n(d,e))}function u(e){var t=e.then_;e.then_=void 0;for(var o=0;o<t.length;o++)a(t[o])}function f(e){e.state_=w,u(e)}function d(e){e.state_=g,u(e)}function m(e){if("function"!=typeof e)throw new TypeError("Promise constructor takes a function argument");if(this instanceof m==!1)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this.then_=[],r(e,this)}var p=e.Promise,h=p&&"resolve"in p&&"reject"in p&&"all"in p&&"race"in p&&function(){var e;return new p(function(t){e=t}),"function"==typeof e}();"undefined"!=typeof exports&&exports?(exports.Promise=h?p:m,exports.Polyfill=m):"function"==typeof define&&define.amd?define(function(){return h?p:m}):h||(e.Promise=m);var v,y="pending",b="sealed",w="fulfilled",g="rejected",k=function(){},x="undefined"!=typeof setImmediate?setImmediate:setTimeout,A=[];m.prototype={constructor:m,state_:y,then_:null,data_:void 0,then:function(e,t){var o={owner:this,then:new this.constructor(k),fulfilled:e,rejected:t};return this.state_===w||this.state_===g?n(a,o):this.then_.push(o),o.then},"catch":function(e){return this.then(null,e)}},m.all=function(e){var o=this;if(!t(e))throw new TypeError("You must pass an array to Promise.all().");return new o(function(t,o){function n(e){return i++,function(o){a[e]=o,--i||t(a)}}for(var r,a=[],i=0,s=0;s<e.length;s++)r=e[s],r&&"function"==typeof r.then?r.then(n(s),o):a[s]=r;i||t(a)})},m.race=function(e){var o=this;if(!t(e))throw new TypeError("You must pass an array to Promise.race().");return new o(function(t,o){for(var n,r=0;r<e.length;r++)n=e[r],n&&"function"==typeof n.then?n.then(t,o):t(n)})},m.resolve=function(e){var t=this;return e&&"object"==typeof e&&e.constructor===t?e:new t(function(t){t(e)})},m.reject=function(e){var t=this;return new t(function(t,o){o(e)})}}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);/**
 * Copyright 2016 FormHero Inc. All rights reserved
 *
 * This software is the property of FormHero Inc (FormHero) which specifically
 * grants the user the right to modify, use and distribute this software
 * provided this notice is not removed or altered.  All other rights are
 * reserved by FormHero.
 *
 * FORMHERO MAKES NO WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, WITH REGARD TO
 * THIS SOFTWARE.  IN NO EVENT SHALL FOMRHERO BE LIABLE FOR INDIRECT, SPECIAL,
 * INCIDENTAL OR CONSEQUENTIAL DAMAGES IN CONNECTION WITH OR ARISING FROM
 * THE FURNISHING, PERFORMANCE, OR USE OF THIS SOFTWARE.
 *
 * So that all may benefit from your experience, please report any problems
 * or suggestions about this software to FormHero Support Services by
 * e-mail at info@formhero.io .
 *
 * FormHero Inc.
 * 600 - 10 Dundas Street East c/o DMZ
 * Toronto, ON
 * M5G 2B9
 * Canada
 *
 */
var formhero=function(e){function t(){return v.protocol+v.servicesPrefix+"."+v.base}function o(e,t){if(t.key.indexOf(".")!=-1)for(var o=t.key.split("."),n=0;n<o.length;n++)void 0==e[o[n]]&&(e[o[n]]={}),n==o.length-1?e[o[n]]=t.value:e=e[o[n]];else null!=e[t.key]?(e[t.key].push||(e[t.key]=[e[t.key]]),e[t.key].push(t.value)):e[t.key]=t.value}function n(e){var t=document.createElement("template");return t.innerHTML=e,t.content.firstChild}function r(e,o,n){return new Promise(function(r,a){var i=new XMLHttpRequest;i.open("POST",t()+"/auth/session/init"),i.withCredentials=!1,i.onload=function(){200===i.status&&i.responseText?r(JSON.parse(i.responseText)):200!==i.status&&a(i.status)},i.onerror=function(){a()};var s=window.sessionStorage.getItem("ngStorage-fhToken")||e.fhToken;s=s.replace(/"/g,""),i.setRequestHeader("X-Formhero-Token",s),i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify({org:e.organization,team:e.team,slug:e.form,prepopulatedData:o,formData:o,signedRequest:n,cname:e.cname}))})}function a(e){return new Promise(function(t,o){var n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href",e),n.onload=t,"undefined"!=typeof n&&document.getElementsByTagName("head")[0].appendChild(n)})}function i(e,t,o){switch(o.viewMode){case"page":case"window":s(e,o);break;case"embedded":c(e,t,o);break;default:l(e,t,o)}}function s(e,t){document.location=e}function c(e,t,o){e+="&iframeId="+t;var n=document.querySelector(o.selector),r=document.createElement("div");r.id="formhero-iframe-wrapper-"+p,r.className="formhero-iframe-wrapper visible embedded";var a=document.createElement("iframe");a.className="formhero-iframe embedded",a.id="form-frame-"+p,a.name="form-frame-"+p,a.src=e,a.frameborder=0,a.frameBorder="0",a.allowTransparency="true",n.clientHeight<450&&console.log("The form's parent container should not have a height smaller than 450px"),n.clientWidth<300&&console.log("The form's parent container should not have a width smaller than 300px"),r.appendChild(a),n.appendChild(r),p++}function l(e,t,o){e+="&iframeId="+t;var r=document.body.scrollTop;document.body.classList.add("formhero-scroll-block");var a=document.createElement("div");a.id="formhero-overlay-"+p,a.className="formhero-overlay hidden",document.body.appendChild(a);var i=document.createElement("div");i.id="formhero-iframe-wrapper-"+p,i.className="formhero-iframe-wrapper hidden";var s=document.createElement("iframe");s.className="formhero-iframe",s.id="form-frame-"+p,s.name="form-frame-"+p,s.src=e+"&viewMode=modal",s.frameborder=0;var c=o.cancelButtonMarkup||'<div class="formhero-cancel-button"><i class="fa fa-trash-o"></i>Cancel</div>',l=o.closeButtonMarkup||'<div class="formhero-cancel-button"><i class="fa fa-close"></i>Close</div>',d=o.saveButtonMarkup||'<div class="formhero-save-button"><i class="fa fa-save"></i>Save &amp; Close</div>',m=n('<div class="formhero-button-panel"></div>'),v=n('<span class="fh-button fh-cancel">'+c+"</span>"),y=n('<span class="fh-button fh-close" style="display:none;">'+l+"</span>"),b=n('<span class="fh-button fh-save">'+d+"</span>");m.appendChild(b),m.appendChild(v),m.appendChild(y),s.frameBorder="0",s.allowTransparency="true",i.appendChild(f()),s.onload=function(){var e=document.getElementById("fh-spinner");e.parentNode.removeChild(e)},i.appendChild(m),i.appendChild(s),h[t].closeModal=function(){a.className="formhero-overlay hidden",i.className="formhero-iframe-wrapper hidden",setTimeout(function(){document.body.removeChild(a),document.body.removeChild(i),document.body.classList.contains("formhero-scroll-block")&&document.body.classList.remove("formhero-scroll-block"),document.body.scrollTop=r},100)};var w=function(e){h[t].isSettled?(h[t].closeModal(e),h[t].closeHandler(e)):u(s,{type:"formhero-js-request",request:"modalClose",buttonAction:e,iframeId:t})};y.addEventListener("click",function(){w("close-after-submit")}),v.addEventListener("click",function(){w("cancel-without-save")}),b.addEventListener("click",function(){w("close-and-save")}),document.body.appendChild(i),p++,setTimeout(function(){a.className="formhero-overlay visible",i.className="formhero-iframe-wrapper visible"},100)}function u(e,t){e.contentWindow.postMessage(t,"*")}function f(){var e=document.createElement("div");return e.id="fh-spinner",e.className="spinner-container",e.appendChild(d()),e}function d(){var e=document.createElementNS("http://www.w3.org/2000/svg","svg"),t=document.createElementNS("http://www.w3.org/2000/svg","circle");return e.appendChild(t),t.setAttribute("class","path"),t.setAttribute("fill","none"),t.setAttribute("stroke-width",10),t.setAttribute("stroke-linecap","round"),t.setAttribute("cx",66),t.setAttribute("cy",66),t.setAttribute("r",60),e.setAttribute("class","spinner"),e.setAttribute("width","130px"),e.setAttribute("height","130px"),e.setAttribute("viewBox","0 0 131 131"),e}var m=!1,p=0,h={},v={base:"formhero.io",protocol:"https://",servicesPrefix:"services"};e.convertMapToObject=function(e){var t={};for(var n in e)n&&n.indexOf("$")==-1&&o(t,{key:n,value:e[n]});return t},e.setFormHeroHost=function(e){"string"==typeof e?v.base=e:(e.base&&(v.base=e.base),e.protocol&&(v.protocol=e.protocol),e.servicesPrefix&&(v.servicesPrefix=e.servicesPrefix))},e.useHttps=function(e){e?v.protocol="https://":v.protocol="http://"},e.closeOpenForms=function(){var e=Array.prototype.slice.call(document.querySelectorAll(".formhero-overlay")),t=Array.prototype.slice.call(document.querySelectorAll(".formhero-iframe-wrapper")),o=e.concat(t);o.forEach(function(e){document.body.removeChild(e)})},window.addEventListener("message",function(e){try{var t=e.data;if(t.iframeId||1!=Object.keys(h).length||(t.iframeId=Object.keys(h)[0]),t.fhResult){if(h[t.iframeId])if(h[t.iframeId].isSettled=!0,t.fhResult&&"form-success"===t.fhResult.state){try{document.querySelector("div.formhero-button-panel span.fh-button.fh-save").style.display="none",document.querySelector("div.formhero-button-panel span.fh-button.fh-cancel").style.display="none",document.querySelector("div.formhero-button-panel span.fh-button.fh-close").style.display="block"}catch(o){}t.fhResult.submittedAt=JSON.stringify(new Date),h[t.iframeId].onFormSuccess(t.fhResult)}else h[t.iframeId].onFormCancel(t.fhResult)}else t.fhStatus&&h[t.iframeId]&&h[t.iframeId].onStatus&&h[t.iframeId].onStatus(t.fhStatus);t.iframeId&&(t.closeRequestResult||t.result)&&h[t.iframeId]&&("cancel"==t.closeRequestResult||"close"!=t.closeRequestResult&&"close"!=t.result||(h[t.iframeId].closeModal(t.buttonAction),h[t.iframeId].closeHandler(t.buttonAction),h[t.iframeId].isSettled&&delete h[t.iframeId])),m=!!t.deferClosing}catch(o){console.error("Unexpected/improperly formatted message received:",o)}},!1);var y=a("https://use.formhero.io/,/formhero.css");return e.loadForm=function(e,t,o,n){return y.then(function(){var a=o||e.onCloseFn,s=n||e.onStatusFn,c=e.prepopulatedData||e.dataMap||t,l=e.signedRequest;return new Promise(function(t,o){if(e||o("You must provide an options object with organization, team and form defined."),"undefined"!=typeof l)try{var n=l.split("."),u=JSON.parse(window.atob(n[1]));u.org&&(u.organization=u.org),e.organization=u.organization,e.form=u.form,e.team=u.team,e.cname=u.cname||e.cname,e.viewMode=u.viewMode||e.viewMode,e.selector=u.selector||e.selector}catch(f){o("The signedRequest is invalid or malformed.")}if("undefined"==typeof e||"undefined"==typeof e.form||"undefined"==typeof e.organization)return void console.error("You must pass an options object with an organization and a form, or provide them in the signedRequest, when calling formHero.");"embedded"===e.viewMode&&"undefined"==typeof e.selector&&console.error("You must pass a selector as an option if you want to embed your form within a page");var d=e.cname||encodeURIComponent(e.organization)+"."+v.base,m="";e.viewMode&&(m="&mode="+e.viewMode);var y=e.cuid?[["form-preview/"],["/",e.cuid]]:[[],[]],b=[v.protocol,d,"/#/"].concat(y[0],[encodeURIComponent(e.team),"/",encodeURIComponent(e.form)],y[1],["?new=true",m]).join(""),w="form-frame-"+p;h[w]={closeHandler:a||function(){},onFormSuccess:t,onFormCancel:o,onStatus:s||function(){},isSettled:!1},c||l?r(e,c,l).then(function(n){b+="&jwt="+n.jwt,i(b,w,e).then(t,o)},function(e){e>=500&&(alert("Invalid Data: We were unable to validate the prepopulated data provided."),o(e))}):i(b,w,e).then(t,o)})})},window.onload=function(){for(var t=document.querySelectorAll("[fh-form]"),o=0;o<t.length;o++){var n=t[o];(n.getAttribute("fh-organization")||n.getAttribute("fh-org"))&&n.getAttribute("fh-team")?(n.style.cursor="pointer",n.addEventListener("click",function(t){return t.preventDefault&&t.preventDefault(),e.loadForm({organization:n.getAttribute("fh-organization")||n.getAttribute("fh-org"),team:n.getAttribute("fh-team"),form:n.getAttribute("fh-form"),viewMode:n.getAttribute("fh-view-mode")||"modal",saveButtonMarkup:'<div style="display: none;"></div>',cancelButtonMarkup:'<div style="cursor: pointer;background-color: black; color: white; border: 3px solid white; border-radius: 50%; padding: 4px 8px 5px 8px;text-align: center;layout: table-cell; font-size: 22px;">&times;</div>',closeButtonMarkup:'<div style="cursor: pointer;background-color: black; color: white; border: 3px solid white; border-radius: 50%; padding: 4px 8px 5px 8px;text-align: center;layout: table-cell; font-size: 22px;">&times;</div>'}),!1})):console.error("Found element with an fh-form attribute, but it is missing fh-organization, fh-team, or the value for fh-organization, unable to attach event handler for this element:",n)}},e}(formhero||{});if("undefined"!=typeof angular)try{angular.module("formhero",[]).factory("formhero",function(){return formhero})}catch(e){console.error("Unable to register formhero module in angular due to exception:",e)}"object"==typeof module&&module.exports?module.exports=formhero:"function"==typeof define&&define.amd&&define([],function(){return formhero});